<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <title>任务列表</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.css">
    <script src="/lib/vue/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
<div class="container">

    <div align="right">
        <button type="button" class="btn btn-info" data-toggle="modal" data-placement="bottom" data-target="#myModal">添加任务</button>
    </div>

    <table class="table table-hover">
        <thead>
        <tr>
            <th>序号</th>
            <th>任务编号</th>
            <th>所属分组</th>
            <th>任务执行CRON</th>
            <th>创建时间</th>
            <th>下次调度时间</th>
            <th>状态</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="(item, index) of page.records" :key="index">
            <td>{{index + 1}}</td>
            <td>{{item.executorHandler}}</td>
            <td>{{item.appName}}</td>>
            <td>{{item.jobCron}}</td>
            <td>{{item.createTime}}</td>
            <td>{{item.trigger_next_time}}</td>
            <td v-text="enableConvert(item.enable, '未知')"></td>
            <td>
                <button type="button" class="btn btn-warning" v-if="item.enable == 1" @click="disable()">停用</button>
                <button type="button" class="btn btn-success" v-if="item.enable == 0" @click="enable()">启用</button>
                <button type="button" class="btn btn-secondary" @click="edit()">编辑</button>
            </td>
        </tr>
        </tbody>
    </table>

    <div align="right">
        共找到<span style="font-size: xx-large">{{page.total}}</span>条记录！
    </div>

    <ul class="pagination">
        <li class="page-item"><a class="page-link" @click="query(page.current-1)">上一页</a></li>

        <li class="page-item" v-for="index of page.pages" :key="index">
            <a class="page-link" @click="query(index)">{{index}}</a>
        </li>
        <li class="page-item"><a class="page-link" @click="query(page.current+1)">下一页</a></li>
    </ul>

</div>

<!-- 模态框 -->
<div class="modal fade" id="myModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- 模态框头部 -->
            <div class="modal-header">
                <h4 class="modal-title">请选择切入类</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- 模态框主体 -->
            <div class="modal-body">
                没有AOP代理类...
            </div>

            <!-- 模态框底部 -->
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmActiveBtn">确认激活</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
            </div>

        </div>
    </div>
</div>

<script>
    new Vue({
        el: ".container",
        mounted: function () {
            this.query(1);
        },
        data: {
            page: {
                'current': 1,
                'pages': 0,
                'records': [],
                'size': 10,
                'total': 0
            }
        },
        methods: {
            query: function (pageNum) {
                var _this = this;
                if (pageNum < 1 || (pageNum > this.page.pages && this.page.pages != 0)) return;
                axios.get('/job/info/page_query', {
                    params: {
                        pageNum: pageNum,
                        pageSize: _this.page.size
                    }
                })
                    .then(function (response) {
                        var data = response.data;
                        if (data.code == 200) {
                            _this.page = data.content;
                        } else {
                            alert(data.msg);
                        }
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            add: function () {
//                window.location.href="./add.html";
            },
            enableConvert: function (key, defaultVal) {
                switch (key) {
                    case 0:
                        return "停用";
                    case 1:
                        return "启用";
                    default:
                        return defaultVal;
                }
            },
        }
    });

</script>
</body>
</html>